filesystem: "root"
path: "/opt/tectonic/bootkube.sh"
mode: 0644
contents:
    inline: |
        #!/bin/bash
        set -e

        # shellcheck disable=SC2154
        /usr/bin/docker run \
            --volume "$(pwd)":/assets \
            --volume /etc/kubernetes:/etc/kubernetes \
            "{{.KubecorerendererImage}}" \
            --config=/assets/kco-config.yaml \
            --output=/assets

        mkdir -p /etc/kubernetes/manifests/
        mv /opt/tectonic/manifests/tectonic-node-controller-pod.yaml /etc/kubernetes/manifests/

        # shellcheck disable=SC2154
        /usr/bin/docker run \
            --volume "$(pwd)":/assets \
            --volume /etc/kubernetes:/etc/kubernetes \
            --network=host \
            --entrypoint=/bootkube \
            "{{.BootkubeImage}}" \
            start --asset-dir=/assets

